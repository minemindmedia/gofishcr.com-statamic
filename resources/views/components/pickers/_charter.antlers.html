{{#
    @name Charter Picker
    @desc Choose charter length for given charter
#}}

<!-- /components/_charter_picker.antlers.html -->

<!-- Define global state with Alpine.store -->

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.store('guestPicker', {
            adults: parseInt(sessionStorage.getItem('_gfcr_adults') || 0),
            children: parseInt(sessionStorage.getItem('_gfcr_children') || 0),
            message: '', // Added for inline message
            updateSessionStorage() {
                sessionStorage.setItem('_gfcr_adults', this.adults);
                sessionStorage.setItem('_gfcr_children', this.children);
                sessionStorage.setItem('_gfcr_guests', this.adults + this.children);
                this.checkSelection(); // Check selection after updating session storage
            },
            incrementAdults() {
                this.adults++;
                this.updateSessionStorage();
            },
            decrementAdults() {
                this.adults = Math.max(0, this.adults - 1);
                if (this.adults === 0) {
                    this.children = 0; // Reset children if no adults
                }
                this.updateSessionStorage();
            },
            incrementChildren() {
                if (this.adults > 0) {
                    this.children++;
                    this.updateSessionStorage();
                }
            },
            decrementChildren() {
                this.children = Math.max(0, this.children - 1);
                this.updateSessionStorage();
            },
            checkSelection() {
                if (this.adults >= 1) {
                    this.message = ""; // Clear message if adults >= 1
                } else {
                    this.message = "Please select at least one adult."; // Show message if no adults selected
                }
            }
        });
        Alpine.store('charterPicker', {
            selectedOption: 'Choose charter length', // Default option set to prompt reselection
            showMessage: false,
            init() {
                // Removed sessionStorage retrieval to ensure reselection on page refresh
                // Initialization logic here
            },
            selectOption(option) {
                this.selectedOption = option;
                this.showMessage = false;
                sessionStorage.setItem('_gfcr_charter', option); // Store in session storage
                // Additional logic here
            },
            checkSelection() {
                if (this.selectedOption === 'Choose charter length') {
                    this.showMessage = true;
                } else {
                    // Redirect or other logic here
                }
            },
            // Additional methods or properties here
        });
    });
</script>

<div x-data="{ open: false }" class="relative">
    <button @click="open = !open" class="px-4 py-2 bg-gray-200 rounded-md focus:outline-none">
        <span x-text="Alpine.store('guestPicker').adults + Alpine.store('guestPicker').children === 0 ? 'Add Guests' : Alpine.store('guestPicker').adults + Alpine.store('guestPicker').children === 1 ? '1 Guest' : Alpine.store('guestPicker').adults + Alpine.store('guestPicker').children + ' Guests'"></span>
    </button>
    <div x-show="open" @click.away="open = false" class="absolute z-50 w-48 w-full mt-2 bg-white rounded-md shadow-lg">
        <!-- Adults -->
        <div class="px-4 py-2">
            <button @click="Alpine.store('guestPicker').decrementAdults()" class="px-2 py-1 text-white bg-red-500 rounded-md focus:outline-none">-</button>
            <span x-text="Alpine.store('guestPicker').adults + ' Adult' + (Alpine.store('guestPicker').adults >= 2 ? 's' : '')" class="px-4"></span>
            <button @click="Alpine.store('guestPicker').incrementAdults()" class="px-2 py-1 text-white bg-green-500 rounded-md focus:outline-none">+</button>
        </div>
        <!-- Children -->
        <div class="px-4 py-2">
            <button :disabled="Alpine.store('guestPicker').adults < 1" @click="Alpine.store('guestPicker').decrementChildren()" class="px-2 py-1 text-white bg-red-500 rounded-md focus:outline-none">-</button>
            <span x-text="Alpine.store('guestPicker').children + (Alpine.store('guestPicker').children === 1 ? ' Child' : ' Children')" class="px-4"></span>
            <button :disabled="Alpine.store('guestPicker').adults < 1" @click="Alpine.store('guestPicker').incrementChildren()" class="px-2 py-1 text-white bg-green-500 rounded-md focus:outline-none">+</button>
        </div>
    </div>
    <!-- Inline Message Display -->
    <div x-text="Alpine.store('guestPicker').message" class="mt-2 text-red-500"></div>
</div>


<div x-data="{ isOpen: false }" class="relative" x-init="$store.charterPicker.init()">
    <!-- Component internals here -->
    <!-- Display Selected Option / Toggle Dropdown -->
    <button @click="isOpen = !isOpen" :class="{'border-red-500': $store.charterPicker.selectedOption === 'Choose charter length', 'border-gray-300': $store.charterPicker.selectedOption !== 'Choose charter length'}" class="flex items-center w-full px-3 py-3 space-x-4 leading-4 text-left text-gray-700 bg-white border rounded-md shadow-sm text-md focus:outline-none focus:ring-1 focus:ring-blue-500">
        <span x-text="$store.charterPicker.selectedOption" class="flex-1"></span>
        <i class="fa-solid fa-angle-down"></i>
    </button>
    <span x-show="$store.charterPicker.showMessage" class="text-xs text-red-500">Please choose a charter length</span>

    <!-- Dropdown Options -->
    <div x-show="isOpen" @click.away="isOpen = false" class="absolute z-50 w-48 mt-2 bg-white border rounded-md shadow-lg">
        <ul class="py-1">
            <!-- Options generated with Antlers templating -->
            {{ pricing }}
                <li @click="$store.charterPicker.selectOption('Half day: {{ half_day }}'); isOpen = false" class="px-4 py-2 cursor-pointer hover:bg-gray-100">Half day: {{ half_day }}</li>
                <li @click="$store.charterPicker.selectOption('3/4 day: {{ three_quarter_day}}'); isOpen = false" class="px-4 py-2 cursor-pointer hover:bg-gray-100">3/4 day: {{ three_quarter_day }}</li>
                <li @click="$store.charterPicker.selectOption('Full day: {{ full_day }}'); isOpen = false" class="px-4 py-2 cursor-pointer hover:bg-gray-100">Full day:{{ full_day }}</li>
            {{ /pricing }}
        </ul>
    </div>
</div>

<!-- Correctly access the global state from outside x-data -->
<a href="#_" @click="Alpine.store('charterPicker').checkSelection(), Alpine.store('guestPicker').checkSelection()" class="px-4 py-2 text-white bg-blue-500 rounded-md focus:outline-none">
    Get Started
</a>
